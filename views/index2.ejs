<script>
    $( document ).ready(function() {
        var cookie = "";
        /*
        $(function(){
            //console.log(cookies);
            $.ajax({
                type: 'POST',
                url: '/',
                success: function(notification) {
                    console.log(notification.cookies);
                    cookie = notification.cookies;
                }
            });
        });
        */

        /*
        function getCookies(callback){
            request({
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'Accept': 'application/json'
                },
                url: 'https://ws.agiloffice.fr/demo/session_login?username=demo3&password=demo3',
                method: 'POST'
            }, function (err, res) {
                console.log('statusCode:', res && res.statusCode);
                if (!err && res.statusCode == 200) {
                    return callback(null, res.headers['agil-cookie']);
                } else {
                    return callback(err);
                }
            });
        }
        */


        function getCookies(callback){
            fetch('https://ws.agiloffice.fr/demo/session_login?username=demo3&password=demo3',{
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json',
                    'Cache': 'no-cache',
                    'Credentials': 'include',

                    //'Cookie': '_agil_ws_'+cookie,
                    //"Access-Control-Allow-Origin": "*",
                },
                success: function(output, status, xhr) {
                    console.log("output", output);
                    console.log("status", status);
                    console.log(xhr);
                    //console.log(xhr.getResponseHeader('Set-Cookie'));
                    //alert(xhr.getResponseHeader("MyCookie"));
                },
                cache: false

            })
                .then(function (data) {
                    console.log('Request success: ', data.json());
                }).then(function(results) {
                console.log("results",results);
                console.log("cookiecookiecookie", cookie);
            });
        }

        //$('#select_link').click(function(e){

        $(function(){
            getCookies(function(err, cookie) {
                if (!err) {
                    console.log("cookies!!!!!" ,cookie);
                    cookies = cookie;
                }
            });




            //$('#select_link').click(function(e){
            e.preventDefault();

            fetch('https://ws.agiloffice.fr/demo/phone_call?phone=8002&number=8003',{
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json',
                    'Cache': 'no-cache',
                    'Credentials': 'include',

                    'Cookie': '_agil_ws_'+cookie,
                    //"Access-Control-Allow-Origin": "*",
                },
                success: function(output, status, xhr) {
                    console.log("output", output);
                    console.log("status", status);
                    console.log(xhr);
                    //console.log(xhr.getResponseHeader('Set-Cookie'));
                    //alert(xhr.getResponseHeader("MyCookie"));
                },
                cache: false

            })
                .then(function (data) {
                    console.log('Request success: ', data.json());
                }).then(function(results) {
                console.log("results",results);
                console.log("cookiecookiecookie", cookie);
            });



            /*
            $.ajax({
                type: 'POST',
                url: 'https://ws.agiloffice.fr/demo/phone_call?number=8002&number=8003',
                cache: false,
                setCookies: '_agil_ws_'+cookie,
                crossDomain: true,
                dataType: 'jsonp',
                xhrFields: {
                    withCredentials: true
                },
                success: function(notification) {
                    console.log(JSON.stringify(notification));
                    if ((JSON.stringify(notification.notification))) {
                        console.log(notification);

                        //location.reload();
                    }
                }
            });*/
            //});
        });
        //<script type="text/javascript" src="script.js">
    });
</script>